# Use an official Miniconda base image
FROM continuumio/miniconda3:latest

# Set the working directory in the container
WORKDIR /app

# Copy only the necessary files (you can adjust this for your project)
COPY ./src /app/src
COPY requirements.txt /app/

# Create the environment from the requirements
RUN conda create -n agent-reviewer python=3.11 -y

# Activate the environment and install dependencies
RUN /bin/bash -c "source activate agent-reviewer && pip install -r requirements.txt"

# Set the PYTHONPATH so Python can find the src/backend module
ENV PYTHONPATH=/app/src:$PYTHONPATH

# Expose the port that the app will run on
EXPOSE 8000

# Run the application using uvicorn
CMD ["/bin/bash", "-c", "source activate agent-reviewer && uvicorn src.main:app --reload"]